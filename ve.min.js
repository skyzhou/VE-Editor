/*! wxCloudEditor 2014-04-08 */
var ve={};ve.util=ve.util||{},ve.lib=ve.lib||{},ve.$=function(e){return document.getElementById(e)},function(v){function Create(e){var t={height:"300px",width:"100%",commands:["bold","italic","underline","FontSize","forecolor","backcolor","justifyleft","justifycenter","justifyright","image","createLink"],container:document.createElement("div"),fixedToolbar:1,floatToolbar:1,imgUploadUrl:""};for(var n in e)t[n]=e[n];this.config=t,this.id=++uniqid;var i="ve_"+this.id,o="st_"+this.id,a="fl_"+this.id,r="toolbar_wrapper_"+this.id;this.containerElement=t.container,this.containerElement.innerHTML=v.util.tmpl(editorTpl,{eId:i,sId:o,fId:a,tbwId:r,config:t}),this.editorElement=v.$(i),this.statusElement=v.$(o),this.floatElement=v.$(a),this.fixedToolbarWrapperEl=v.$(r),this.panelinView=[],this._init(),editors[editors]=this}document.domain=document.domain;var uniqid=0,editors={},initFn=[],destroyFn=[],readyFn=[],iconUrl="http://qzonestyle.gtimg.cn/open_proj/proj_qcloud_v2/ac/light/dashboard/toolbar.png",editorTpl='<div  style="width:<%=config.width%>;" class="ve-editor-wrap"><div class="ve-fixed-toolbar" id="<%=tbwId%>"></div><% if (config.fixedToolbar) { var extraCls = " has-fixed-toolbar"} %><div _event="ve-edit" style="height:<%=config.height%>;"  id="<%=eId%>" contenteditable="true" class="ve-editor<%=extraCls%>"></div><div class="ve-statusbar" id="<%=sId%>" style="display:none;"><span>加载中……</span><a _event="ve-close" class="close">关闭</a></div><div class="ve-float" id="<%=fId%>" style="display:none;"></div></div>';Create.prototype={_init:function(){var e=this;v.util.insertStyleSheet(v.util.tmpl(".ve-editor-wrap{          background:#fff;        position:relative;        padding:0px;        overflow-y:auto;        position:relative;    }    .ve-editor{        word-break:break-all;        padding:10px;        outline:none;        overflow-x:hidden;        min-height:100px;        line-height:normal;    }    .ve-editor strong{        font-weight:bold;    }    .ve-editor em{        font-style:italic;    }    .ve-statusbar{        position:absolute;        height:25px;        background:#F0E68C;        top:4px;        right:4px;        transition: opacity .5s ease-in-out;        font-size:13px;        opacity:0;    }    .ve-float{        position:absolute;        z-index:999;    }    .ve-statusbar span{        float:left;        margin:5px 10px;        color:#7F7F7F;    }    .ve-statusbar .close{        float:left;        margin:5px 10px;        cursor:pointer;        color:#00c;    }    .ve-toolbar{        font-size: 0px;        padding: 3px;        height: 26px;        line-height: 26px;        background-color: #FFF;        -webkit-box-shadow: 0 3px rgba(0, 0, 0, 0.1);        -moz-box-shadow: 0 3px rgba(0,0,0,.1);        box-shadow: 0 3px rgba(0, 0, 0, 0.1);        border: solid 1px #CBCBCB;    }    .ve-fixed-toolbar .ve-toolbar{        -webkit-box-shadow: none;        -moz-box-shadow: none;        box-shadow: none;        width: auto;    }    .ve-toolbar a{        width: 25px;        height: 24px;        display: inline-block;        background-color: #FFF;        border: 1px solid #FFF;        border-radius: 2px;        text-align: center;        line-height: 24px;        position: relative;        font-size: 12px;    }    .ve-toolbar .active,.ve-toolbar a:hover{        border:1px solid #939598;        background-image: -webkit-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));        background-image: -moz-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));        background-image: -o-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));        background-image: -ms-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));        background-image: linear-gradient(to top, rgba(0,0,0,.05), rgba(255,255,255,.05))    }       .ve-toolbar a span{        display: inline-block;        width: 20px;        height: 20px;        pointer-events: none;        font-size: 0;        line-height: 0;        overflow: hidden;        zoom: 1;        vertical-align: middle;        background: url(<%=icon%>) no-repeat;    }    .ve-toolbar .bold{        background-position: -20px -20px;    }    .ve-toolbar .strikethrough{         background-position: -20px -160px;    }    .ve-toolbar .underline{         background-position: -20px -60px;    }    .ve-toolbar .forecolor{         background-position: -20px -80px;    }    .ve-toolbar .italic{         background-position: -20px -40px;    }    .ve-toolbar .backcolor{         background-position: 0px -180px;    }     .ve-toolbar .FontSize{         background-position: -20px -221px;    }     .ve-toolbar .createLink{         background-position: -20px -200px;    }    .ve-toolbar .justifyleft{         background-position: -20px -100px;    }    .ve-toolbar .justifycenter{         background-position: -20px -120px;    }    .ve-toolbar .justifyright{         background-position: -20px -140px;    }    .ve-toolbar .image{        background-position: -20px -243px;    }    .ve-panel-wrap{        transition: opacity .2s ease-in-out;        opacity:0;        z-index:999;    }    .ve-panel{        background-color:#fff;        border: 1px solid #ccc;        box-shadow: 0 2px 4px rgba(0,0,0,.15);        padding: 10px;    }    .ve-color{        width: 210px;        height: 115px;    }    .ve-color a{        cursor: pointer;        display: inline-block;        height: 15px;        width: 15px;        box-shadow: 0 1px 1px rgba(0, 0, 0, .05) inset ;        border:2px solid #fff;        font-size:0;        float: left;    }    .ve-color a:hover{        border:2px solid #548dd4;    }    .ve-fontsize{        width: 165px;        padding: 10px 0px;        overflow:auto;    }    .ve-fontsize a{        cursor: pointer;        display: block;        color: #000;        padding: 4px 10px;        text-decoration:none;    }    .ve-fontsize a:hover{        background-color:#eee;    }    .ve-createLink{        width:360px;    }    .ve-uploadimg{        width:365px;        padding:0 0 10px;    }    .ve-toolbar-separator{         color: #CCCCCC;        font-size: 12px;        margin: 0 5px;    }    .has-fixed-toolbar{        border: 1px solid #CBCBCB;        border-top: none;    }    .ve-editor img {        max-width:100%    }    .ve-toolbar a.zoom-link{        position:absolute;         right:10px;        width:56px    }    .ve-maximize .ve-editor-wrap{        position: fixed;        left: 100px;        top: 100px;        right: 100px;        bottom: 100px;        z-index: 1100    }    .ve-maximize .slide-panel, .ve-maximize .main{        overflow: inherit!important    }    .ve-maximize-mask{        position:fixed;        left:0;        top:0;        width:100%;        height:100%;        z-index:1000;        background:#000;    }    .ve-maximize .ve-fixed-toolbar .ve-toolbar{        border:none;        border-bottom:1px solid #cbcbcb    }    .ve-maximize .has-fixed-toolbar{        border:none    }    .ve-editor p {        margin: 1em 0;    }    .ve-editor b, .ve-editor strong {        font-weight: bold;    }    .ve-editor i, .ve-editor em {        font-style: italic;    }    .error .ve-toolbar{        border-top:none;        border-left:none;        border-right:none;    }    .error .has-fixed-toolbar{        border:none;    }",{ua:v.ua,icon:iconUrl}),"editorStyle");for(var t,n=0;t=destroyFn[n];n++)t.call(this);initFn.sort(function(e,t){return e.index-t.index});for(var t,n=0;t=initFn[n];n++)t.call(this);var i=setInterval(function(){if(document.body){for(var t,n=0;t=readyFn[n];n++)t.call(e);clearInterval(i),readyFn=[]}},100)},getContent:function(){return this.editorElement.innerHTML},getTitle:function(){var e=document.createElement("div");e.innerHTML=this.editorElement.innerHTML;for(var t,n=e.getElementsByTagName("p"),i=0;t=n[i];i++)"size"==t.className&&(t.innerHTML="");e.innerHTML=e.innerHTML.replace(/<\!\-\-no gettitle start\-\->[\s\S]*<\!\-\-no gettitle end\-\->/gi,"");var o=e.innerText||e.textContent||"";return o=o.replace(/(^\s+|\s+$)/g,"").substr(0,40),o.split(/(\r\n|\r|\n)/)[0]},setContent:function(e,t,n){this.editorElement.innerHTML=n?e:this.filterHtml(e),t&&this.focus()},focus:function(){this.setFocusAt(this.editorElement)},onReady:function(e){readyFn.push(e)},appendTo:function(e){e.appendChild(this.editorElement)},filterHtml:function(e){return v.util.filterHtml(e)},uploadImage:function(imageBlob,url,options){var _self=this,Upload=ve.lib.Upload,loader=new Upload({url:url,name:"image",onprogress:function(e,t,n){if(!options.progress||options.progress(e,t,n)){var i=parseInt(100*(t/n));i>99&&(i=99),_self.displayStatusBar("图片上传中："+i+"%")}},oncomplete:function(data){data=eval("("+data+")"),options.complete&&options.complete(data)}});loader.addFile(imageBlob),loader.send()},isEmpty:function(){return""==this.editorElement.innerHTML.replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," ").replace(/\r\n|\n|\r/,"")}},v.$extend=function(e,t){var t=t||999;for(var n in e)"$"==n.charAt(0)?v[n]=e[n]:/^_init/.test(n)?(e[n].index=t,initFn.push(e[n])):/^_destroy/.test(n)?destroyFn.push(e[n]):Create.prototype[n]=e[n]},v.Create=Create,(new Image).src=iconUrl}(ve),function(e){var t='<div  class="ve-toolbar" unselectable="on"><% for(var i=0,pl;pl = plugins[i];i++) { %><% if (pl == "|") { %><span class="ve-toolbar-separator">|</span><% } else { %><a href="javascript:;" title="<%=(pl.description+(pl.shortcut?"("+pl.shortcut.join("+")+")":""))%>" command="<%=pl.command%>" _event="ve-command" class="<%=prefix%>_tool_<%=pl.command%>"  hidefocus="true"><span class="<%=pl.className%>"></span></a><% } %><% } %></div>',n=[],i=!1;e.$extend({_initToolbar:function(){var i=this,o=function(t){e.util.bindEvt(t,"click",{"ve-command":function(){var e=this.getAttribute("command");i.execCommand(e),i.updateToolStat()}})};this.config.floatToolbar&&(this.toolbarElement=this.createToolPanel(e.util.tmpl(t,{plugins:this.plugins,prefix:"float"}),this.id),o(this.toolbarElement)),this.config.fixedToolbar&&(this.fixedToolbarWrapperEl.innerHTML=e.util.tmpl(t,{plugins:this.plugins,prefix:"fixed"}),o(this.fixedToolbarWrapperEl)),this.onReady(function(){for(var e,t=i.getPanelContainer(),o=0;e=n[o];o++)e&&t.appendChild(e)})},_destroyThis:function(){n=[]},getPanelContainer:function(){var e=document.getElementById("vePanelContainer");return e||(e=document.createElement("div"),e.id="vePanelContainer",document.body.appendChild(e)),e},displayStatusBar:function(t){t?(this.statusElement.firstChild.innerHTML=t,this.statusElement.style.display="",this.statusElement.style.opacity=1):e.util.hide(this.statusElement,200)},displayFloatDiv:function(t,n){if(t){var i=e.util.getPostion(n),o=e.util.getPostion(this.editorElement),a=this.floatElement;a.innerHTML=t,a.style.top=i.top-o.top+"px",a.style.left=i.left-o.left+"px",a.style.display="",this.setEventHdl("floatElement","del-img",function(){n.parentNode.removeChild(n)})}else a.style.display="none"},displayPanel:function(t,n){var i=this;n=n||{},t&&(t.tm&&(e.util.clear(t.tm),t.tm=null),t.uniqid||(t.uniqid="u_"+ +new Date));for(var o,a=0;o=this.panelinView[a];a++)t&&o.uniqid==t.uniqid||(o.blur(),e.util.hide(o,200),this.panelinView.splice(a,1),this.clearCatchBodyClick());if(!t)return i.forbid=!0,e.util.hide(i.toolbarElement,n.delay,function(){i.forbid=!1}),void 0;t.style.display="";var r=e.util.getPostion(t),l=e.util.getPostion(this.editorElement),s=e.util.getPostion(),d=Math.max(document.body.scrollTop,document.documentElement.scrollTop),c=Math.max(document.body.scrollLeft,document.documentElement.scrollLeft),p=Math.max(document.documentElement.clientHeight||document.body.clientHeight),u=0,f=0;if(i.catchBodyClick(t),n.panel)if(this.panelinView.push(t),n.position)if(n.position.auto)n.position.x=Math.max(parseInt((l.width-r.width)/2),0),n.position.y=Math.max(parseInt((l.height-r.height)/2),0),u+=n.position.x+l.left,f+=n.position.y+l.top,d>f&&(f=0);else if(n.position.relative){var m=e.util.getPostion(n.position.relative),g=n.position.deviation||{};u+=m.left+(g.x||0),f+=m.bottom+(g.y||0)}else u+=n.position.x||0,f+=n.position.y||0;else u+=s.left,f+=s.top+30;else{var h=this.range.getBoundingClientRect();u+=h.left,f+=h.bottom+5}u+r.width>l.left+l.width&&(u-=r.width-(n.panel?27:-5)),f+r.height>p&&(f-=r.height+33),u+=c,f+=d,t.style.opacity=1,n.keep||(t.style.left=u+"px",t.style.top=f+"px",n.panel||this.updateToolStat())},clickHandler:function(){this.displayPanel()},catchBodyClick:function(){var e=this,t=null;if(!i){this.clickHandler=function(n){var i=n.target||n.srcElement,o=i.parentNode,a=o&&/(ve-toolbar|float_tool)/.test(o.className);return a?!1:(t&&new Date-t>100&&e.displayPanel(),void 0)};var t=+new Date;document.body.addEventListener?document.body.addEventListener("click",this.clickHandler):document.body.attachEvent("onclick",this.clickHandler),i=!0}t=+new Date},clearCatchBodyClick:function(){this.clickHandler&&(document.body.removeEventListener?document.body.removeEventListener("click",this.clickHandler):document.body.detachEvent("onclick",this.clickHandler),i=!1)},createToolPanel:function(e,t){var n=this.getPanelContainer(),i=document.createElement("div");return i.innerHTML=e,i.className="ve-panel-wrap ve-panel-tool",i.id="vePaneTool"+t,i.style.display="none",i.style.position="absolute",n.appendChild(i),i},updateToolStat:function(){if(e.currentIns=this,document.queryCommandState){var t=[],n=[];this.fixedToolbarWrapperEl&&(t=this._makeArray(this.fixedToolbarWrapperEl.getElementsByTagName("a"))),this.toolbarElement&&(n=this._makeArray(this.toolbarElement.getElementsByTagName("a")));for(var i,o=t.concat(n),a=0;i=o[a];a++)i.className.indexOf("active")>=0&&(i.className=i.className.replace("active",""));for(var r,l=!1,s=this.containerElement,d=document.getElementById("vePaneTool"+this.id),a=0;r=this.plugins[a];a++)if("|"!=r){try{l=document.queryCommandState(r.command)}catch(c){}var p=e.util.getClass("float_tool_"+r.command,"a",d)[0],u=e.util.getClass("fixed_tool_"+r.command,"a",s)[0];l&&(p&&(p.className=p.className+" active"),u&&(u.className=u.className+" active"))}}},_makeArray:function(e){try{return[].slice.call(e)}catch(t){for(var n,i=0,o=[];n=e[i];)o[i++]=n;return o}},createPanel:function(t,i){i=i||{};var o=e.util.getClass("ve-panel-"+i.cmd,"div");if(o.length)o=o[0];else{var o=document.createElement("div");o.innerHTML=t,o.className="ve-panel-wrap ve-panel-"+i.cmd,o.style.display="none",o.style.position="absolute",n.push(o)}return o}})}(ve),function(e){var t,n={},i=0,o=null,a={floatElement:{}};e.$extend({_initEvent:function(){var n=this,i=function(i){var o=i.x,a=i.y,r=i.type;return e.util.lazy(function(){if(!n.forbid)if(n.hasRange()){var e={x:o+5,y:a+8,type:r};n.isNewRange()||(e.keep=!0),n.displayPanel(n.toolbarElement,e)}else n.displayPanel()},60),t=+new Date,!n.fire(i)},r=function(e){return!n.fire(e)};e.util.bindEvt(this.containerElement,"mousedown",{"ve-edit":r}),e.util.bindEvt(this.containerElement,"mouseup",{"ve-edit":i}),e.util.bindEvt(this.containerElement,"click",{"ve-img":function(){n.selectNode(this)},"ve-link":function(e){var t=this.href;e.ctrlKey&&/^http/i.test(t)&&window.open(t)},"ve-edit":function(){n.updateToolStat()}}),e.util.bindEvt(this.containerElement,"dblclick",{"ve-img":function(){n.selectNode(this);var e=this.getAttribute("src");e=e.replace(/\/\d+$/,"/0"),window.open(e)}}),e.util.bindEvt(this.floatElement,"mouseup",a.floatElement),e.util.bindEvt(this.containerElement,"keydown",{"ve-edit":i}),e.util.bindEvt(this.containerElement,"keyup",{"ve-edit":i}),e.util.bindEvt(this.containerElement,"paste",{"ve-edit":function(e){return 600>new Date-t&&o&&clearTimeout(o),l(e)},"ve-img":function(e){return 600>new Date-t&&o&&clearTimeout(o),l(e)}});var l=function(e){var t=e.clipboardData||window.clipboardData,i=t.getData("text"),r=!0;if(a.beforepaste)for(var l in a.beforepaste)a.beforepaste[l](e,i)||(r=!1);return o=setTimeout(function(){n.saveFocus();var t=n.getContent();if(t&&(n.setContent(t),n.setFocusAt(),n.saveRange()),a.afterpaste)for(var o in a.afterpaste)a.afterpaste[o](e,i)},300),r};e.util.bindEvt(this.statusElement,"mousedown",{"ve-close":function(){n.displayStatusBar()}}),t=+new Date,this.addEvtListener("keydown",function(e){var t=e.keyCode;return(8==t||46==t)&&document.selection&&/control/i.test(document.selection.type)?(this.deleteContents(),!0):void 0})},addEvtListener:function(e,t){return!n[this.id]&&(n[this.id]={}),!n[this.id][e]&&(n[this.id][e]=[]),t.id=++i,n[this.id][e].push(t),i},removeEvtListener:function(e){var t=n[this.id];for(var i in t)for(var o,a=0;o=t[i][a];a++)if(o.id==e)return t.splice(a,1),!0},fire:function(e){var t=e.type,i=!1;if(n[this.id]&&n[this.id][t])for(var o,a=0;o=n[this.id][t][a];a++)o.call(this,e)&&(i=!0);return i},getLastInputTime:function(){return t},setEventHdl:function(e,t,n){a[e]||(a[e]={}),a[e][t]=n},getEventHdl:function(e,t){return a[e]?t?a[e][t]:a[e]:void 0}})}(ve),function(e){var t=[],n={ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},i={18:"altKey",17:"ctrlKey",16:"shiftKey"},o={altKey:18,ctrlKey:17,shiftKey:16};e.$extend({getFnKeys:function(e){var t=[];for(var n in o)e[n]&&t.push(n);return t.sort()},addShortcut:function(e,o){var a=this,r=[];e=e.join(",").replace(/ctrl|shift|alt/gi,function(e){var t=n[e];return r.push(t),t}).split(","),r.sort(),t.push(e),this.addEvtListener("keydown",function(t){var n=t.keyCode,l=this.getFnKeys(t);return i[n]||l.join("-")!=r.join("-")||e.slice(-1)[0].charCodeAt(0)-32!==t.keyCode?void 0:(o.call(a,t),!0)})}})}(ve),function(e){var t=function(e){this.ieRange=e,this.collapsed=!0,this.commonAncestorContainer=e.parentElement?e.parentElement():null,this.endContainer=null,this.endOffset=0,this.startContainer=null,this.startOffset=0};t.prototype={cloneContents:function(){return this.ieRange.duplicate().text},cloneRange:function(){},collapse:function(){this.ieRange.collapse()},compareBoundaryPoints:function(){},compareNode:function(){},comparePoint:function(){},createContextualFragment:function(){},deleteContents:function(){this.ieRange.execCommand("delete")},detach:function(){},expand:function(){},extractContents:function(){},getBoundingClientRect:function(){var e=this.ieRange.getBoundingClientRect(),t={};return e.width?(t=e,e.width=e.right-e.left,e.height=e.bottom-e.top):t={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top},t},getClientRects:function(){},insertNode:function(e){var t=document.createElement("div");t.appendChild(e);var n=t.innerHTML;/img/i.test(e.nodeName)&&(n+="<span></span>"),this.ieRange.pasteHTML(n)},intersectsNode:function(){},isPointInRange:function(){},selectNode:function(){},selectNodeContents:function(){},setEnd:function(){},setEndAfter:function(){},setEndBefore:function(){},setStart:function(){},setStartAfter:function(){},setStartBefore:function(){},surroundContents:function(){},toString:function(){return this.ieRange.text}};var n=[],i=null;e.$extend({range:null,hasRange:function(){this.saveRange();var e=window.getSelection?""+window.getSelection():document.selection.createRange().text;return e?!0:void 0},isNewRange:function(){return 2>n.length?!0:""+n[0]!=""+n[1]},getRange:function(){var e,n;return window.getSelection?(e=window.getSelection(),n=e.rangeCount?e.getRangeAt(0):this.getLastRange()||{}):n=new t(document.selection.createRange()),n},getLastRange:function(){return n[0]},selectRange:function(e){if(e=e||n[0])if(window.getSelection){var t=window.getSelection();t.addRange(e)}else n[0].ieRange.select()},selectNode:function(e){if(window.getSelection){var t=document.createRange();t.selectNode(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}},setFocusAt:function(t,n){var t=t;if(t&&t.parentNode||(t=e.$(i)),t){var o,a;if(void 0==n)if(t.innerHTML){var r=""==t.innerHTML.replace(/<(?!img|embed).*?>/gi,"").replace(/&nbsp;/gi," ").replace(/\r\n|\n|\r/,"");n=r?!0:!1}else n=!1;if(document.createRange){if(/img/i.test(t.tagName)){var a=window.getSelection();if(a){var l=Array.prototype.slice.call(this.editorElement.childNodes,0),s=l.indexOf(t);a.collapse(this.editorElement,s+1)}}else o=document.createRange(),o.selectNodeContents(t),o.collapse(n),a=window.getSelection(),a.removeAllRanges(),a.addRange(o);t.focus&&t.focus()}else if(document.selection){try{o=document.body.createTextRange(),o.moveToElementText(t),o.collapse(n),o.select()}catch(d){}t.focus()}}},saveFocus:function(){i="f_"+(new Date).valueOf();var e=document.createElement("span");e.setAttribute("name","empt"),e.id=i;var t=this.getRange();t.insertNode(e),emptElem=e},saveRange:function(){this.range=this.getRange(),n.unshift(this.range)},insertNode:function(t){if(n[0]){if(n[0].commonAncestorContainer&&this.editorElement.contains&&!e.ua.isie&&!this.editorElement.contains(n[0].commonAncestorContainer))return this.editorElement.appendChild(t),void 0;n[0].insertNode(t)}else this.editorElement.appendChild(t);this.setFocusAt(t,!0)},deleteContents:function(){this.getRange().deleteContents()}})}(ve),function(e){var t={};e.$extend({_initPlugins:function(){for(var e in t)t[e]=this._buildPlugin(t[e]);this.plugins=[];for(var n,i=0;n=this.config.commands[i];i++)if("|"==n)this.plugins.push("|");else{var o=t[n];o&&this.plugins.push(o)}},_buildPlugin:function(t){var n=this;if(t.panel){var i=this.createPanel(t.panel,{cmd:t.command});t.dialog=function(e){this.displayPanel(i,{panel:!0,position:t.position||e}),t.onAfterDialog&&t.onAfterDialog.call(this,i,t.callback)};var o={};o["ve-"+t.command]=function(e,i){t.value=i.getAttribute("value"),n.execCommand(t.command,t.value,{from:"dialog"})},e.util.bindEvt(i,"click",o)}return t.shortcut&&this.addShortcut(t.shortcut,function(){n.execCommand(t.command,t.value,{from:"shortcut"})}),t.onInit&&t.onInit.call(this),t},$addPlugin:function(e){t[e.command]={value:e.value,panel:e.panel,command:e.command,className:e.className||e.command,dialog:null,execCommand:e.execCommand,onAfterDialog:e.onAfterDialog,shortcut:e.shortcut||"",description:e.description||"",position:e.position,onInit:e.onInit}},execCommand:function(n,i,o){var a,r=e.currentIns||this,l=t[n],s=o||{};return!s.from&&l.dialog?(s.callback&&(l.callback=function(e){s.callback.call(r,e),r.callback=null}),l.dialog.call(r,s.position),void 0):(r.editorElement.focus(),l.execCommand?a=l.execCommand.call(r,i,s.callback):(a=document.execCommand(n,!1,i||l.value),r.displayPanel(null,{delay:300})),a)}},1)}(ve),function(e){for(var t,n=[["cut","Cut"],["copy","Copy"],["paste","Paste"],["bold","Bold","加粗",["ctrl","b"]],["forecolor","fgcolor"],["italic","Italic","斜体",["ctrl","i"]],["underline","Underline","下划线",["ctrl","u"]],["strikethrough","<s>","删除线",["ctrl","shift","s"]],["createLink","<a>"],["inserthorizontalrule","<hr />"],["undo","Undo"],["redo","Redo"],["backcolor","bgcolor"],["hilitecolor","hilite"],["increasefontsize","A+"],["decreasefontsize","A-"],["fontname","font-family"],["FontSize","font-size"],["subscript","<sub>"],["superscript","<sup>"],["justifyleft","left","居左",["ctrl","alt","l"]],["justifyright","right","居右",["ctrl","alt","r"]],["justifycenter","center","居中",["ctrl","alt","c"]],["justifyfull","justify"],["insertorderedlist","<ol>"],["insertunorderedlist","<ul>"],["insertparagraph","<p>"],["inserthtml","html"],["formatblock","formatblock"],["heading","heading"],["indent","indent"],["outdent","outdent"],["contentreadonly","readonly"],["delete","del"],["unlink","unlink"]],i=0;t=n[i];i++)e.$addPlugin({command:t[0],value:t[1],description:t[2],shortcut:t[3]})}(ve),function(e){var t={keyup:[],keydown:[]},n=[],i=function(n){var i=this,o=i.getRange();if(o.collapsed){var a=o.commonAncestorContainer;if(a&&3==a.nodeType)for(var r,l=a.data,s=0;r=t[n.type][s];s++)for(var d,c=e.util.isArray(r.reg)?r.reg:[r.reg],s=0;d=c[s];s++)if(l.match(d))return r.callback.call(i,{textNode:a,event:n,range:o}),void 0}};e.$extend({_initMark:function(){this.addEvtListener("keyup",i),this.addEvtListener("keydown",i);for(var e,t=0;e=n[t];t++)e.call(this)},$addMark:function(e){var i={reg:e.reg,callback:e.callback,type:e.type||"keyup",onInit:e.onInit};i.onInit&&n.push(i.onInit),t[i.type].push(i)}})}(ve),function(e){var t=navigator.userAgent;e.ua=function(){var e=/msie/i.test(t),n=/msie\s+?6/i.test(t),i=/firefox/i.test(t);return{isie:e,isie6:n,isFirefox:i}}()}(ve),function(e){var t,n,i,o,a,r,l=function(){},s=[],d=[],c=function(e){var i=new FormData;d.forEach(function(e){i.append(e.name,e.value)}),i.append(n,e);var a=new XMLHttpRequest;a.upload.addEventListener("progress",function(t){o(e.name,t.loaded,t.total)},!1),a.onload=function(){r(a.responseText)},a.open("post",t,!0),a.send(i)},p=function(e){t=e.url||"",n=e.name||"file",i=e.serial||!1,o=e.onprogress||l,a=e.onerror||l,r=e.oncomplete||l};p.prototype={addFile:function(e){s.push(e)},addFiles:function(e){for(var t=0;e.length>t;t++)this.addFile(e[t])},addParam:function(e,t){d.push({name:e,value:t})},setSerial:function(){},send:function(){for(;s.length;)c(s.shift())}},e.Upload=p,window.veUpload=p}(ve.lib),function(e,t){var n;e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},e.tmpl=function(){function e(e,t){if(t)for(var n in t){var i=RegExp("<%#"+n+"%>","g");e=e.replace(i,t[n])}return e}var t={};return function n(i,o,a){a=a||{};var r=a.key,l=a.mixinTmpl,s=!/\W/.test(i);r=r||(s?i:null);var d=r?t[r]=t[r]||n(e(s?document.getElementById(i).innerHTML:i,l)):Function("obj","var _p_=[],print=function(){_p_.push.apply(_p_,arguments);};with(obj){_p_.push('"+i.replace(/[\r\t\n]/g," ").split("\\'").join("\\\\'").split("'").join("\\'").split("<%").join("	").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("_p_.push('")+"');}return _p_.join('');");return o?d(o):d}}(),e.addEvt=function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n)},e.getElementByAttribute=function(e,t,n){for(n=n||document.body;e&&1==e.nodeType;){var i=e.getAttribute(t);if(null!==i)return e;if(e==n)return;e=e.parentNode}},e.bindEvt=function(t,i,o,a){e.addEvt(t,i,function(t){var i=t.target||t.srcElement;n=i;var r=e.getElementByAttribute(i,"_event",this);if(!r)return!0;var l=!0,s=!1;if(e.isFunction(o))l=o.call(r,t,r,a),s=!0;else{var d=r.getAttribute("_event");d&&o[d]&&(l=o[d].call(r,t,r,a),s=!0)}s&&!l&&(t.preventDefault?t.preventDefault():t.returnValue=!1)})},e.createDiv=function(e,t){var n=document.createElement("div");return n.innerHTML=e,t.display&&(n.style.display=t.display),t.position&&(n.style.position=t.position),t.parent&&t.parent.appendChild(n),n},e.getPostion=function(e){try{e=e||n||document.body;var t=e.getBoundingClientRect(),i={};return t.width?(i=t,t.width=t.right-t.left,t.height=t.bottom-t.top):i={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top},i}catch(o){return{}}},e.insertStyleSheet=function(e,t){if(!document.getElementById(t)){var n=document.createElement("style");return n.type="text/css",n.id=t,document.getElementsByTagName("head")[0].appendChild(n),e&&(n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))),n.sheet||n}},e.lazy=function(e,t){return setTimeout(e,t)},e.clear=function(e){clearTimeout(e)},e.sptTransition=function(){for(var e,t=document.documentElement.style,n="t,webkitT,MozT,msT,OT".split(","),i=0,o=n.length;o>i;i++)if(e=n[i]+"ransform",e in t)return n[i].substr(0,n[i].length-1);return!1},e.hide=function(e,t,n){e&&(n=n||function(){},this.sptTransition()&&t?(e.style.opacity=0,e.tm=this.lazy(function(){e.style.display="none"},t)):e.style.display="none",t?this.lazy(function(){n()},t):n())},e.writeFrame=function(e,n,i,o,a){var r,l,s=t.ua,d=t.$(e);if(!d){var d=document.createElement("iframe");d.setAttribute("frameBorder","0"),d.setAttribute("scrolling","no"),d.name=e,d.id=e,n.appendChild(d)}d.callback=o,a=a||{};for(var c in a)d.style[c]=a[c];s.isie||navigator.userAgent.indexOf("Trident")>0?(d.src='javascript:(function(){document.open();document.domain="'+document.domain+'";document.close();})()',setTimeout(function(){try{l=window.frames[e]||t.$(e).contentWindow,r=l.contentDocument||l.document,r.open(),r.write(i),r.close()}catch(n){}},100)):setTimeout(function(){d.src="javascript:'"+encodeURIComponent(i)+"'"},50)},e.text2Html=function(e){return e?e.replace(/\r\n|\r|\n/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/,"&nbsp;"):""},e.clone=function(e){var t={};for(var n in e)t[n]=e[n];return t},e.filterHtml=function(e){e=e||"",e=e.replace(/<(script|iframe|head|style)[^>]*>[\s\S]*?<\/(script|iframe|head|style)>/gi,""),e=e.replace(/(<\w+)([^>]*>)/gi,function(e,t,n){return n=n.replace(/(\W)(on\w+\s*=)/gi,"$1_$2").replace(/javascript\:/gi,"#"),n=n.replace(/(\W)((?:position|float)\s*\:)/gi,"$1_$2"),/img/i.test(t)?(n=n.replace(/(height)\s*([:=])/gi,"_$1$2"),/_event/i.test(e)||(t+=' _event="ve-img"')):/<a/i.test(t)&&(/data-event/i.test(e)||(t+=' _event="ve-link"')),t+n});var n=t.util.addFindLink(e);return n&&(e=n),e},e.addFindLink=function(e){var t=/(\W|^)(www(?:\.\w+){2,})(\W|$)/gi,n=/https?:\/\/(?:[\w\-]+\.)+\w+(?:\/[^'"\s\b<>]*)?/gi,i=e,o=0,a={},r=function(e,i){return e.replace(n,function(e){return o++,a[o]=i?e:'<a href="'+e+'"  _event="ve-link">'+e+"</a>","<"+o+">"}).replace(t,function(e,t,n,r){return o++,a[o]=i?e:t+'<a href="http://'+n+'" _event="ve-link">'+n+"</a>"+r,"<"+o+">"})},l=[],s=0;return i=i.replace(/<\!\-\-no url start\-\->[\s\S]*<\!\-\-no url end\-\->/gi,function(e){return l.push(e),"%"+s++ +"%"}),i=i.replace(/<a[\s\S]+?<\/a>/gi,function(e){return r(e,!0)}),i=i.replace(/<\w+[^>]+>/gi,function(e){return r(e,!0)}),n.test(i)||t.test(i)?(i=r(i).replace(/<(\d+)>/g,function(e,t){return a[t]}),l.length&&(i=i.replace(/%(\d+)%/gi,function(e,t){return l[t]})),i):void 0};var i={escHTML:{re_amp:/&/g,re_lt:/</g,re_gt:/>/g,re_apos:/\x27/g,re_quot:/\x22/g},restXHTML:{re_amp:/&amp;/g,re_lt:/&lt;/g,re_gt:/&gt;/g,re_apos:/&(?:apos|#0?39);/g,re_quot:/&quot;/g}};e.restHTML=function(t){var n=i.restXHTML;return e.listReplace(t+"",{"<":n.re_lt,">":n.re_gt,"'":n.re_apos,'"':n.re_quot,"&":n.re_amp})},e.escHTML=function(t){var n=i.escHTML;return e.listReplace(t+"",{"&amp;":n.re_amp,"&lt;":n.re_lt,"&gt;":n.re_gt,"&#039;":n.re_apos,"&quot;":n.re_quot})},e.commonReplace=function(e,t,n){return e.replace(t,n)},e.listReplace=function(t,n){if(e.isObject(n)){for(var i in n)t=e.commonReplace(t,n[i],i);return t}return t+""},e.getClass=function(e,t,n){n=n||document;var i=[];if(document.querySelectorAll)i=n.querySelectorAll("."+e);else for(var o,a=n.getElementsByTagName(t),r=0;o=a[r];r++)for(var l=o.className.split(" "),s=0;l.length>s;s++)if(l[s]===e){i.push(o);break}return i}}(ve.util,ve),function(e){e.$addPlugin({command:"cancel",execCommand:function(){this.displayPanel()}})}(ve),function(e){var t=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],n='<div  class="ve-panel ve-color"  unselectable="on"><% for(var i=0,item;item = colors[i];i++) { %><a href="javascript:;" value="<%=item%>" _event="ve-<%=command%>" style="background-color:<%=item%>;"></a><% } %></div>';e.$addPlugin({command:"forecolor",panel:e.util.tmpl(n,{colors:t,command:"forecolor"}),description:"字体颜色",shortcut:["ctrl","shift","f"],value:"#c0504d"}),e.$addPlugin({command:"backcolor",panel:e.util.tmpl(n,{colors:t,command:"backcolor"}),description:"背景颜色",shortcut:["ctrl","shift","b"],value:"#ffff00"})}(ve),function(e){var t=[{value:1,size:"10px",text:"1(10px)"},{value:2,size:"12px",text:"2(12px)"},{value:3,size:"14px",text:"3(14px)"},{value:4,size:"16px",text:"4(16px)"},{value:5,size:"18px",text:"5(18px)"},{value:6,size:"24px",text:"6(24px)"},{value:7,size:"36px",text:"7(36px)"}];
e.$addPlugin({command:"FontSize",panel:e.util.tmpl('<div  class="ve-panel ve-fontsize" unselectable="on"><% for(var i=0,item;item = fontsizes[i];i++) { %><a href="javascript:;"  _event="ve-FontSize" value="<%=item.value%>" style="font-size:<%=item.size%>;"><%=item.text%></a><% } %></div>',{fontsizes:t}),description:"字号",shortcut:["ctrl","alt","f"],value:4})}(ve),function(e){e.$addPlugin({command:"image",panel:e.util.tmpl('    <div  class="ve-panel ve-uploadimg" style="background-color:#ffffff">            </div>',{}),onAfterDialog:function(t,n){var i=this,o=t.children[0],a=i.config.imgUploadUrl;a+=/\?/.test(a)?"&":"?t="+new Date,e.util.writeFrame("v_img_upload",o,e.util.tmpl('    <html>        <head>            <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>            <style>                html{color:#000;background:none;font-size:12px;font-family:arial,宋体,Arial Unicode MS,Mingliu,Arial,Helvetica;}                body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td{margin:0;padding:0;}                table{border-collapse:collapse;border-spacing:0;}                fieldset,img{border:0;}                address,caption,cite,code,dfn,th,var{font-style:normal;font-weight:normal;}                li{list-style:none;}                caption,th{text-align:left;}                h1,h2,h3,h4,h5,h6{font-size:100%;}                abbr,acronym{border:0;font-variant:normal;}                sup{vertical-align:text-top;}                sub{vertical-align:text-bottom;}                input,textarea,select{font-family:inherit;font-size:inherit;font-weight:inherit;}                input,textarea,select{<% if (ve.ua.isie) { %>*font-size:100%; <% } %>}                legend{color:#000;}                a{text-decoration:none;color:#6b6b6b;cursor:pointer;}                a *{cursor:pointer;}                a:hover{text-decoration:underline;}                input{outline:none }                .tab{padding:7px 20px 0;height:30px;border-bottom:1px solid #e2e2e2;background-color:#f9f9f9;}                .tab li{float:left;display:inline;height:28px;line-height:28px;width:83px;text-align:center;font-size:14px;position:relative;bottom:-1px;z-index:1;border:1px solid #F9F9F9;border-bottom:1px solid #e2e2e2;cursor:pointer;}                .tab .active{color:#3c4854;border:1px solid #e2e2e2;border-bottom:1px solid #fff;background-color:#fff;}                .wrap{width:365px;height:134px;}                .panel .pic_add{overflow:hidden;                    <% if (ve.ua.isie) { %>                        zoom:1;                    <% } %>                 }                .panel{padding:20px;}                .panel_upload form{width:0;height:0;overflow:hidden;}                .panel_upload .pic_add label{width:80px;height:20px;line-height:20px;text-align:center;display:inline-block;cursor:pointer;}                .panel_upload .pic_add .file_name{margin-left:10px;display:inline-block;width:155px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;}                .panel_upload .btns{padding-left:60px;margin-top:10px;}                .panel_upload .btns a{margin-right:10px;}                .panel_url input{width:238px;height:26px;line-height:26px;border:1px solid #dadada;}                .panel_url .btns{float:right;display:inline;margin-top:10px;}                .panel_url .btns a{margin-left:10px;}                .progress{position: relative;height: 25px;width: 200px;margin-left: 20px;}                .progress span{display: inline-block;height: 25px;width:2px;background: #ccc;}                .progress label{position: absolute;right: -40px;top:3px;}                .g_btn{display:inline-block;height:26px;line-height:26px;width:51px;text-align:center;}                .g_btn:hover{text-decoration:none;}                .g_btn_3{color:#3d4958;border-radius:3px;                background-color: #fff;                border: solid 1px #cbcbcb;                background-image: -moz-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                <% if (!ve.ua.isFirefox) { %>                     background-image: -webkit-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                    background-image: -o-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                    background-image: -ms-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                    background-image: linear-gradient(to top, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                <% } %>                }                .g_btn_3:hover{                border: solid 1px #939598;                background-image: -moz-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                <% if (!ve.ua.isFirefox) { %>                    background-image: -webkit-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                    background-image: -o-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                    background-image: -ms-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                    background-image: linear-gradient(to top, rgba(0,0,0,.05), rgba(255,255,255,.05));                <% } %>                }                .g_btn_3:active{                -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,.3);                box-shadow: inset 0 3px 5px rgba(0,0,0,.3);                border: solid 1px #939598;                background-image: -moz-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                <% if (!ve.ua.isFirefox) { %>                    background-image: -webkit-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                    background-image: -o-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                    background-image: -ms-linear-gradient(bottom, rgba(0,0,0,.05), rgba(255,255,255,.05));                    background-image: linear-gradient(to top, rgba(0,0,0,.05), rgba(255,255,255,.05));                <% } %>                }            </style>        </head>        <script type="text/javascript">            var domain = "<%=domain%>";            var action = "<%=action%>";            if(domain){                document.domain = domain;            }                        var isAllowAccess = function(){                var a = document.createElement("a");                a.href = action;                return a.hostname == domain;                            }();            function $(id){                return document.getElementById(id)            }                        function upload(){                var pBar = $("progress");                var pIMG = pBar.firstChild;                var pTXT = pBar.lastChild;                var fIpt = $("img_0");                var dForm = $("fileForm");                var form = $("uploader");                                if(!/.(png|jpg|jpeg|bmp|gif)$/i.test(fIpt.value||"")){                    setName({value:"仅支持png、jpg、gif、bmp"});                    return;                }                               pIMG.style.width = "2px";                pTXT.innerHTML = "0%";                dForm.style.display = "none";                pBar.style.display = "";                if(window.FormData && isAllowAccess){                    var file = fIpt.files[0];                                        var Upload = parent.ve.lib.Upload;                    var loader = new Upload({                        url:action,                        name:fIpt.name,                        onprogress:function(name,p1,p2){                            var p = parseInt(p1/p2*100);                            if(p>99){                                p=99;                            }                            pIMG.style.width = p*2+"px";                            pTXT.innerHTML = p+"%";                        },                        oncomplete:function(data){                           eval("frameElement.callback("+data+")")                        }                    });                    loader.addFile(file);                    loader.send();                }                else{                    form.submit();                }                }            function insert(){                var url = $("img_1").value.replace(/["<>]/g,"");                                if(!/^http/.test(url)){                    return;                }                frameElement.callback({ecode:0,"url":url,net:true});            }            function cancel(){                 frameElement.callback();            }            function setName(el){                $("img_name").innerHTML = el.value;            }            function change(i){                var j = 1-i;                $("opt_"+i).className = "active";                $("opt_"+j).className = "";                $("panel_"+i).style.display = "";                $("panel_"+j).style.display = "none";                if(i){                    $("img_"+i).focus();                }            }        </script>        <body>            <div class="wrap">                <ul class="tab">                    <li class="active" id="opt_0" onclick="change(0)">本地上传</li>                    <li id="opt_1" onclick="change(1)">网络图片</li>                </ul>                <div class="panel panel_upload" id="panel_0">                    <div id="fileForm">                         <p class="pic_add">                            添加图片：                            <label class="g_btn_3" for="img_0">选择文件</label>                            <span class="file_name" id="img_name"></span>                        </p>                        <p class="btns">                            <a href="javascript:;" class="g_btn g_btn_3" onclick="upload()">上传</a>                            <a href="javascript:;" class="g_btn g_btn_3" onclick="cancel()">取消</a>                        </p>                        <form action="<%=action%>&format=html" method="post" id="uploader" enctype="multipart/form-data">                            <p>添加图片：<input class="pic_input" id="img_0" type="file" name="image" onchange="setName(this)"></p>                            <a onclick="upload()">确定</a>                        </form>                    </div>                     <div  class="progress" id="progress" style="display:none;"><span></span><label></label></div>                </div>                <div class="panel panel_url" id="panel_1" style="display:none;">                    <p>插入网络照片：<input id="img_1" type="text" placeholder="http://"></p>                    <p class="btns"><a class="g_btn g_btn_3" onclick="insert()">确定</a><a class="g_btn g_btn_3"  onclick="cancel()">取消</a></p>                </div>            </div>         </body>    </html>',{domain:document.domain,name:"image",action:a}),function(e){if(!e)return i.displayPanel(),void 0;if(e.url){var t=e.url;n?n({src:t}):i.execCommand("insertimage",t),i.displayStatusBar()}else n?n({msg:e.msg||"上传出错！"}):i.displayStatusBar(e.msg||"上传出错！");i.displayPanel()},{height:"134px",width:"365px"})},onInit:function(){var t=this;e.util.bindEvt(this.editorElement,"dragenter",function(){}),e.util.bindEvt(this.editorElement,"dragover",function(){}),e.util.bindEvt(this.editorElement,"drop",function(e){var n=e.dataTransfer.files;n&&/image/.test(n[0].type)&&t.uploadImage(n[0],action,{complete:function(e){if(e){if(e.url){var n=e.url;t.execCommand("insertimage",n),t.displayStatusBar()}return!0}}})})}}),e.$addPlugin({command:"insertimage",execCommand:function(e){var t=document.createElement("img");t.src=e,t.setAttribute("_event","ve-img"),this.insertNode(t)}})}(ve),function(e){e.$addPlugin({command:"createLink",description:"添加链接",panel:e.util.tmpl('<div  class="ve-panel ve-createLink"></div>',{}),onAfterDialog:function(t){var n=this,i="http://";n.saveRange(),e.util.writeFrame("v_add_link",t.firstChild,e.util.tmpl('    <html>        <head>            <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>            <style>                body{                    padding: 0px;                    margin: 0px;                    font-size: 14px;                }                input{                   width: 207px;                    height: 27px;                    outline: none;                    background-color: #F9F9F9;                    color: #999D9E;                    border: 1px solid #DADADA;                    font-family: inherit;                    font-size: inherit;                    font-weight: inherit;                    letter-spacing: normal;                    word-spacing: normal;                    text-transform: none;                    text-indent: 0px;                    text-shadow: none;                    display: inline-block;                    text-align: start;                }                input, .btn_add {                    margin-right: 10px;                }                .btn{                    display: inline-block;                    height: 26px;                    line-height: 26px;                    width: 51px;                    text-align: center;                }                .btn_1{                    color: #3D4958;                    border-radius: 3px;                    background-color: #FFF;                    border: solid 1px #CBCBCB;                    background-image: -moz-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                    <% if (!/firefox/i.test(navigator.userAgent)) { %>                     background-image: -webkit-linear-gradient(bottom, rgba(0, 0, 0, 0.02), rgba(255, 255, 255, 0.02) 46%);                    background-image: -o-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                    background-image: -ms-linear-gradient(bottom, rgba(0,0,0,.02), rgba(255,255,255,.02) 46%);                    background-image: linear-gradient(to top, rgba(0, 0, 0, 0.02), rgba(255, 255, 255, 0.02) 46%);                    <% } %>                }                a{                    text-decoration: none;                    cursor: pointer;                }            </style>        </head>        <script type="text/javascript">            <% if(domain){ %>            document.domain = "<%=domain%>";            <% } %>            function addLink(){                frameElement.callback(document.getElementById("link").value);            }            function removeLink(){                frameElement.callback();            }        </script>        <body>            <input id="link" value="<%=href%>"/>            <a onclick="addLink()" class="btn btn_1 btn_add">添加</a>            <a onclick="removeLink()" class="btn btn_1">删除</a>        </body>    </html>',{domain:document.domain,href:i}),function(e){var t=n.getRange();if(n.selectRange(t),e){var i=t.toString&&""+t;i?n.execCommand("createLink",e,{from:"dialog"}):(n.editorElement.focus(),t=n.getRange(),t.insertNode($("<a>").attr("href",e).text(e)[0]),n.displayPanel(null,{delay:300}))}else n.execCommand("unlink","unlink",{from:"dialog"})},{height:"30px",width:"360px"})}})}(ve),function(e){e.$addPlugin({onInit:function(){this.addEvtListener("keydown",function(t){if(9==t.keyCode){var n=document.createElement("span");return n.id="content_tab",n.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;",n["class"]="content_tab",this.insertNode(n),this.setFocusAt(e.$("content_tab")),e.$("content_tab").removeAttribute("id"),!0}8==t.keyCode})}})}(ve),function(e){var t=/(\W|^)(www(?:\.\w+){2,})(\W|$)/g,n=/https?:\/\/(?:[\w\-]+\.)+\w+(?:\/[^'"\s\b<>]*)?/g;e.$addMark({reg:[n,t],callback:function(t){var n=t.event.keyCode;if(32==n||13==n){this.saveFocus();var i=e.util.addFindLink(this.getContent());i&&(this.setContent(i,!1,!0),this.setFocusAt())}},type:"keydown",onInit:function(){e.util.bindEvt(this.editorElement,"click",function(e,t){if(/a/i.test(t.nodeName)&&/^(https?|ftp)/i.test(t.href)){if(/#inner/i.test(t.href))return;window.open(t.href,"")}})}})}(ve),function(e){var t=/((?:password|密码)[\s:：])(.+?)(\s|&nbsp;)/;e.$addMark({reg:t,callback:function(e){var n=e.event.keyCode;if(32==n||13==n){this.saveFocus();var i=e.textNode.parentNode,o=i.innerHTML,a=0,r={};if(o=o.replace(/<mm:password.+?<\/mm:password>/gi,function(e){return a++,r[a]=e,"<"+a+">"}),!t.test(o))return;o=o.replace(t,function(e,t,n,i){return'<mm:password class="ve-password" title="'+n+'">'+t+Array(n.length+1).join("*")+"</mm:password>"+i}).replace(/<(\d+)>/g,function(e,t){return r[t]}),i.innerHTML=o,this.setFocusAt()}}})}(ve);